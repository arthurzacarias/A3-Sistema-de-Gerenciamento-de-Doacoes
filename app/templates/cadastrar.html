<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <title>Cadastrar Doação</title>
    <script>
    async function buscarCEP() {
        let cep = document.getElementById("cep").value;
        // Remove traços para evitar erro
        cep = cep.replace(/\D/g, ''); 
        
        if (cep.length === 8) {
            let res = await fetch(`/api/cep/${cep}`);
            let dados = await res.json();

            if (dados && !dados.erro) {
                document.getElementById("logradouro").value = dados.logradouro;
                document.getElementById("bairro").value = dados.bairro;
                document.getElementById("cidade").value = dados.cidade;
                document.getElementById("estado").value = dados.estado;
                
                // Foca no campo número para o usuário digitar
                document.getElementById("numero").focus();
            } else {
                alert("CEP não encontrado");
            }
        }
    }
    </script>
</head>
<body>
    <h1>Cadastrar Doação</h1>
    
    <form method="POST" action="/doacoes">
        <h3>Dados do Item</h3>
        <label>Item:</label>
        <input type="text" name="item" required placeholder="Ex: Arroz, Camiseta">

        <label>Quantidade:</label>
        <input type="text" name="quantidade" required>

        <label>Tipo:</label>
        <select name="tipo">
            <option>Alimento</option>
            <option>Roupa</option>
            <option>Material</option>
            <option>Outro</option>
        </select>

        <h3>Endereço de Retirada</h3>
        <label>CEP:</label>
        <input type="text" id="cep" name="cep" onblur="buscarCEP()" placeholder="00000-000" required>

        <label>Logradouro (Rua/Av):</label>
        <input type="text" name="logradouro" id="logradouro" required readonly style="background-color: #f0f0f0;">

        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>Número:</label>
                <input type="number" name="numero" id="numero" required>
            </div>
            <div style="flex: 1;">
                <label>Complemento:</label>
                <input type="text" name="complemento" id="complemento" placeholder="Apto, Bloco...">
            </div>
        </div>

        <label>Bairro:</label>
        <input type="text" name="bairro" id="bairro" required readonly style="background-color: #f0f0f0;">

        <div style="display: flex; gap: 10px;">
            <div style="flex: 3;">
                <label>Cidade:</label>
                <input type="text" name="cidade" id="cidade" required readonly style="background-color: #f0f0f0;">
            </div>
            <div style="flex: 1;">
                <label>UF:</label>
                <input type="text" name="estado" id="estado" required readonly style="background-color: #f0f0f0;">
            </div>
        </div>

        <label>Status:</label>
        <select name="status">
            <option>Pendente</option>
            <option>Recebido</option>
        </select>

        <button type="submit" class="botao">Salvar</button>
        <button type="button" class="botao" style="background-color: #6c757d;" onclick="window.location.href='/'">Voltar</button>
    </form>
</body>
</html>